# Scalping Trainer V3 기능정의서

## 1. 프로젝트 개요

### 1.1 프로젝트명
**Scalping Trainer V3** - 실시간 스캘핑 시뮬레이터

### 1.2 프로젝트 목적
- 실시간 암호화폐 가격 데이터를 활용한 스캘핑 거래 시뮬레이션
- 거래자들의 실전 연습 및 전략 검증을 위한 교육용 도구
- 포지션 관리, 리스크 관리, 매매일지 기능을 통한 체계적인 거래 학습

### 1.3 기술 스택
- **Backend**: FastAPI, Uvicorn, SQLAlchemy, SQLite
- **Frontend**: React, Vite, Tailwind CSS, TradingView Lightweight Charts
- **데이터 소스**: Binance WebSocket API, Binance REST API
- **데이터베이스**: SQLite (거래 내역 저장)

## 2. 시스템 아키텍처

### 2.1 전체 구조
```
Frontend (React + Vite) ←→ Backend (FastAPI) ←→ Binance API
                              ↓
                         SQLite Database
```

### 2.2 주요 컴포넌트
- **데이터 피드**: 실시간 가격 데이터 수신 및 브로드캐스팅
- **거래 서비스**: 포지션 관리 및 거래 실행
- **리포트 서비스**: 일별 손익 분석
- **차트 컴포넌트**: TradingView 기반 실시간 차트
- **거래 패널**: 주문 입력 및 포지션 관리

## 3. 핵심 기능

### 3.1 실시간 차트 기능

#### 3.1.1 차트 표시
- **차트 라이브러리**: TradingView Lightweight Charts
- **차트 타입**: 캔들스틱 차트 (OHLCV)
- **실시간 업데이트**: WebSocket을 통한 실시간 가격 반영
- **다양한 시간프레임**: 1m, 3m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 12h, 1d, 1w

#### 3.1.2 기술적 지표
- **EMA (지수이동평균)**: EMA20, EMA50 (사용자 정의 가능)
- **거래량**: 히스토그램 형태로 표시
- **가격 라인**: 매수가, 청산가, 목표가, 손절가 표시
- **고점/저점**: 최근 20개 데이터 포인트 기준

#### 3.1.3 차트 설정
- **로케일 설정**: 다국어 지원 (한국어, 영어 등)
- **시간대 설정**: Asia/Seoul, UTC, America/New_York 등
- **가격 정밀도**: 소수점 자리수 설정 (0-8자리)
- **최소 이동 단위**: 가격 표시 최소 단위 설정
- **날짜 형식**: YYYY-MM-DD, DD-MM-YYYY, MM-DD-YYYY
- **시간 형식**: 12시간/24시간, 초 표시 여부

#### 3.1.4 프리셋 기능
- **Scalping 프리셋**: EMA9, EMA20, 거래량 표시
- **Swing 프리셋**: EMA20, EMA50, 거래량 표시
- **Long 프리셋**: EMA50, EMA200, 거래량 표시
- **Minimal 프리셋**: 기본 차트만 표시

### 3.2 거래 패널 기능

#### 3.2.1 주문 입력
- **수량 설정**: BTC 단위로 수량 입력 (최소 0.001)
- **레버리지 설정**: 2x, 3x, 5x, 10x, 20x, 25x, 30x, 50x, 100x
- **목표 수익률**: 5%, 10%, 20%, 50%, 100%
- **손절 비율**: 1%, 2%, 3%, 5%, 7%, 10%, 15%, 20%

#### 3.2.2 가격 계산
- **청산가격**: 레버리지 기반 자동 계산
- **목표가격**: 현재가 + 목표 수익률
- **손절가격**: 현재가 - 손절 비율
- **예상 투자금액**: 현재가 × 수량
- **예상 수익/손실**: 목표가/손절가 기준 계산

#### 3.2.3 포지션 관리
- **현재 포지션 표시**: 방향, 수량, 평단가, 현재가, 미실현손익
- **포지션 청산**: 전체 청산, 부분 청산 (25%, 50%, 100%)
- **포지션 상태**: LONG (매수), SHORT (매도), 없음

### 3.3 매매일지 기능

#### 3.3.1 일별 상세 보기
- **거래 요약**: 총 손익, 거래 수, 승률, 거래량, 최대 수익/손실
- **거래 내역**: 시간, 심볼, 방향, 가격, 수량, 거래금액, 손익
- **날짜 선택**: 특정 날짜의 거래 내역 조회

#### 3.3.2 요약 보기
- **일별 거래 요약**: 날짜별 거래 통계
- **성과 지표**: 승률, 총 손익, 거래량, 최대 수익/손실
- **클릭 상세**: 요약에서 특정 날짜 클릭 시 상세 보기로 전환

#### 3.3.3 통계 계산
- **승률**: 수익 거래 수 / 전체 거래 수 × 100
- **평균 수익/손실**: 수익/손실 거래의 평균
- **거래량**: 가격 × 수량의 합계
- **거래 시간**: 첫 거래부터 마지막 거래까지의 시간

### 3.4 설정 기능

#### 3.4.1 계좌 설정
- **총 자산**: 전체 투자 자산 설정
- **거래소별 잔고**: Binance, Bybit, OKX 잔고 설정

#### 3.4.2 거래 성향
- **투자 성향**: 공격적, 보통, 보수적
- **투자 방식**: 초단타(1-5분), 단타(5-30분), 중기(30분-2시간), 장기(2시간+)

#### 3.4.3 리스크 관리
- **일일 거래 한도**: 하루 최대 거래 횟수
- **연속 손절 한도**: 연속 손절 허용 횟수
- **최대 포지션 크기**: 단일 포지션 최대 크기
- **손실 한도**: 일일/주간/월간 손실 한도

#### 3.4.4 기본 거래 설정
- **기본 레버리지**: 2x, 3x, 5x, 10x, 20x, 25x, 30x, 50x, 100x
- **기본 손절**: 1%, 2%, 3%, 5%, 7%, 10%, 15%, 20%
- **기본 익절**: 5%, 10%, 20%, 50%, 100%

#### 3.4.5 재진입 설정
- **수익 후 재진입 제한**: 수익 후 재진입 여부
- **대기 시간**: 재진입까지 대기 시간 (분)

#### 3.4.6 알림 설정
- **거래 알림**: 거래 실행 시 알림
- **수익 알림**: 수익 발생 시 알림
- **손실 알림**: 손실 발생 시 알림
- **일일 리포트**: 일일 거래 리포트 알림

#### 3.4.7 표시 설정
- **통화 소수점**: USD 표시 소수점 자리수 (0-4자리)
- **가격 소수점**: 가격 표시 소수점 자리수 (0-4자리)
- **수량 소수점**: 수량 표시 소수점 자리수 (0, 2, 4, 6, 8자리)

### 3.5 심볼 관리 기능

#### 3.5.1 심볼 선택
- **기본 심볼**: BTCUSDT, ETHUSDT, XRPUSDT, SOLUSDT, DOGEUSDT, SUIUSDT
- **커스텀 심볼**: 사용자 정의 심볼 추가
- **실시간 전환**: 심볼 변경 시 실시간 차트 업데이트

#### 3.5.2 즐겨찾기 그룹
- **그룹 관리**: 여러 심볼을 그룹으로 관리
- **그룹별 프리셋**: 그룹별 차트 설정 저장/적용
- **그룹 순서**: 심볼 순서 변경 (위/아래 이동)
- **그룹 삭제**: 불필요한 그룹 삭제

## 4. API 명세

### 4.1 REST API

#### 4.1.1 거래 관련
- `POST /api/trade` - 주문 실행
- `GET /api/trades` - 최근 50개 거래 내역 조회
- `GET /api/position` - 현재 포지션 조회
- `POST /api/position/close` - 포지션 청산

#### 4.1.2 리포트 관련
- `GET /api/report/daily` - 일별 손익 리포트

#### 4.1.3 차트 관련
- `GET /api/candles` - 캔들 데이터 조회

#### 4.1.4 시스템 관련
- `GET /healthz` - 헬스 체크
- `GET /readyz` - 준비 상태 체크
- `GET /metrics` - 메트릭 조회

### 4.2 WebSocket API

#### 4.2.1 실시간 가격
- `ws://localhost:8001/ws/price?symbol=BTCUSDT` - 실시간 가격 스트림

## 5. 데이터베이스 설계

### 5.1 거래 테이블 (trades)
```sql
CREATE TABLE trades (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    symbol VARCHAR NOT NULL,           -- 심볼 (BTCUSDT)
    side VARCHAR NOT NULL,             -- 방향 (BUY/SELL)
    price FLOAT NOT NULL,              -- 체결 가격
    qty FLOAT NOT NULL,                -- 수량
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    pnl FLOAT DEFAULT 0.0              -- 손익
);
```

## 6. 사용자 인터페이스

### 6.1 메인 대시보드
- **상단 네비게이션**: 대시보드, 매매일지, 세팅 탭
- **심볼 선택**: 드롭다운 + 커스텀 입력
- **연결 상태**: WebSocket 연결 상태 표시
- **현재 가격**: 실시간 가격 표시

### 6.2 차트 영역
- **TradingView 차트**: 실시간 캔들스틱 차트
- **기술적 지표**: EMA, 거래량, 가격 라인
- **차트 컨트롤**: 시간프레임, 히스토리, 지표 설정
- **무한 스크롤**: 과거 데이터 자동 로드

### 6.3 거래 패널
- **주문 입력**: 수량, 레버리지, 목표가, 손절가
- **가격 정보**: 현재가, 청산가, 목표가, 손절가
- **포지션 정보**: 현재 포지션 상태 및 미실현손익
- **주문 버튼**: 매수(LONG), 매도(SHORT) 버튼

### 6.4 거래 내역 테이블
- **최근 거래**: 최근 50개 거래 내역 표시
- **거래 정보**: 시간, 심볼, 방향, 가격, 수량, 손익

### 6.5 PnL 리포트
- **일별 손익**: 선택한 날짜의 손익 요약
- **거래 통계**: 거래 수, 승률, 평균 수익/손실

## 7. 보안 및 성능

### 7.1 보안
- **CORS 설정**: 모든 오리진 허용 (개발용)
- **입력 검증**: Pydantic 모델을 통한 입력 검증
- **SQL 인젝션 방지**: SQLAlchemy ORM 사용

### 7.2 성능
- **캐싱**: Redis 지원 (선택적)
- **Rate Limiting**: API 호출 제한
- **연결 풀링**: 데이터베이스 연결 풀링
- **비동기 처리**: FastAPI 비동기 처리

### 7.3 모니터링
- **Prometheus 메트릭**: 캐시 히트율, Rate Limit, 재시도 등
- **헬스 체크**: 시스템 상태 모니터링
- **로깅**: 거래 및 오류 로깅

## 8. 배포 및 운영

### 8.1 개발 환경
- **Backend**: `python main.py` (포트 8001)
- **Frontend**: `npm run dev` (포트 3131)
- **데이터베이스**: SQLite 파일

### 8.2 프로덕션 환경
- **Docker**: Dockerfile 및 docker-compose.yml 제공
- **정적 파일**: React 빌드 파일 서빙
- **환경 변수**: REDIS_URL 등 설정

### 8.3 테스트
- **E2E 테스트**: Playwright 기반 테스트
- **API 테스트**: 차트 및 API 기능 테스트

## 9. 확장 가능성

### 9.1 추가 기능
- **다중 심볼**: 여러 심볼 동시 거래
- **백테스팅**: 과거 데이터 기반 전략 테스트
- **알림 시스템**: 이메일, 슬랙 알림
- **사용자 관리**: 다중 사용자 지원

### 9.2 기술적 개선
- **Redis 클러스터**: 고가용성 캐싱
- **PostgreSQL**: 대용량 데이터 처리
- **Kubernetes**: 컨테이너 오케스트레이션
- **모니터링**: Grafana, ELK 스택

## 10. 제약사항

### 10.1 현재 제한사항
- **포지션 지속성**: 서버 재시작 시 포지션 초기화
- **단일 심볼**: 동시에 하나의 심볼만 거래
- **실제 거래**: 시뮬레이션만 지원 (실제 거래 불가)
- **데이터 소스**: Binance API에만 의존

### 10.2 향후 개선사항
- **포지션 영속성**: 데이터베이스에 포지션 저장
- **다중 거래소**: 여러 거래소 API 지원
- **실제 거래**: 실제 거래소 연동 (옵션)
- **고급 차트**: 더 많은 기술적 지표

---

**문서 버전**: 1.0  
**최종 수정일**: 2024년 12월  
**작성자**: AI Assistant
